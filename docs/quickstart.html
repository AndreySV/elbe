<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Embedded Linux Build Environment (ELBE) Quickstart Guide • ELBE</title>
    
    
    
      
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Embedded Linux Build Environment (ELBE) Quickstart Guide">
	
	
	
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="http://elbe-rfs.org/images/elbe-icon.png">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en_US.UTF-8">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Embedded Linux Build Environment (ELBE) Quickstart Guide">
	
	<meta property="og:url" content="http://elbe-rfs.org/docs/quickstart.html">
	<meta property="og:site_name" content="ELBE">

    <link rel="canonical" href="http://elbe-rfs.org/docs/quickstart.html">

    <link href="http://elbe-rfs.org/atom.xml" type="application/atom+xml" rel="alternate" title="ELBE Atom Feed">
    <link href="http://elbe-rfs.org/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="http://elbe-rfs.org/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://elbe-rfs.org/js/vendor/html5shiv.min.js"></script>
      <script src="http://elbe-rfs.org/js/vendor/respond.min.js"></script>
    <![endif]-->

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

    <header id="masthead">
  <div class="inner-wrap">
    <a href="http://elbe-rfs.org/" class="site-title"><img src="http://elbe-rfs.org/images/elbe-logo-small.png"></a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">ELBE</a></li>
	
    
        
    
    <li><a href="http://elbe-rfs.org/download" >Download</a></li>
  
    
        
    
    <li><a href="http://elbe-rfs.org/docs" >Docs</a></li>
  
    
        
    
    <li><a href="http://elbe-rfs.org/support" >Support</a></li>
  
    
        
    
    <li><a href="http://elbe-rfs.org/devel" >Devel</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->

    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>ELBE <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="http://elbe-rfs.org/download">
        
        <div class="title">Download</div>
        <p class="excerpt">Get Binary and Source packages</p>
      </a>
    </li><li>
      <a href="http://elbe-rfs.org/docs">
        
        <div class="title">Docs</div>
        <p class="excerpt">Documentation and man-pages</p>
      </a>
    </li><li>
      <a href="http://elbe-rfs.org/support">
        
        <div class="title">Support</div>
        <p class="excerpt">Community and commercial support</p>
      </a>
    </li><li>
      <a href="http://elbe-rfs.org/devel">
        
        <div class="title">Devel</div>
        <p class="excerpt">Development details</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>


    <div id="page-wrapper">
      <h1>Embedded Linux Build Environment (ELBE) Quickstart Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You have probably received a root-filesystem, which has been built with ELBE.<br>
Additionally you should have an XML file describing the root-filesystem.</p>
</div>
<div class="paragraph">
<p>This quickstart guide describes the steps necessary to rebuild the<br>
root-filesystem from the XML file and to simple modifications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="steps-necessary">Steps necessary</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>install Debian 8 (Jessie) on your Host</p>
</li>
<li>
<p>install ELBE on Host Linux</p>
</li>
<li>
<p>generate the <code>initvm</code> running the buildenvironment</p>
</li>
<li>
<p>build the root-filesystem inside the initvm</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Steps 1 and 2 need only be performed once.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When Debian is running inside a VM (vmware etc), you need to make sure,<br>
      that nested KVM is working.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customisation-of-the-build">Customisation of the build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ELBE XML can contain an archive, which can contain configuration files,<br>
and additional software. This archive is extracted onto the target-image<br>
during the buildprocess. It allows you to override any file, which needs to be<br>
different from the default Debian Install.</p>
</div>
<div class="paragraph">
<p>This guide also explains how the archive can be extracted from the XML file,<br>
and vice versa.</p>
</div>
<div class="paragraph">
<p>ELBE allows to manipulate the generated root-filesystem through a set of<br>
<code>&lt;finetuning&gt;</code> rules. We also describe, how these can be used to add a user,<br>
change directory permissions, and remove files from the root-filesystem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-elbe">Installing ELBE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several possibilities to install ELBE.<br>
The simplest method is by installing prebuilt binary packages<br>
via Linutronix package repository on a Debian 8 (Jessie) system.</p>
</div>
<div class="paragraph">
<p>But ELBE can also be installed from git.</p>
</div>
<div class="sect2">
<h3 id="binary-debian-packages">Binary Debian packages</h3>
<div class="paragraph">
<p>The latest packages for elbe reside in the following repository</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://debian.linutronix.de/elbe</pre>
</div>
</div>
<div class="paragraph">
<p>Create the file <code>/etc/apt/sources.list.d/elbe.list</code><br>
with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>deb http://debian.linutronix.de/elbe jessie main</pre>
</div>
</div>
<div class="paragraph">
<p>Then run (as root):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ apt-get update
$ apt-get install elbe</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="git-version">Git Version</h3>
<div class="paragraph">
<p>If you can not use Debian Jessie, you can also checkout the current<br>
ELBE source-code via git from github.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git clone https://github.com/Linutronix/elbe.git
Cloning into 'elbe'...
remote: Counting objects: 5435, done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 5435 (delta 1), reused 0 (delta 0), pack-reused 5427
Receiving objects: 100% (5435/5435), 1.94 MiB | 1.92 MiB/s, done.
Resolving deltas: 100% (3943/3943), done.
Checking connectivity... done.
$ cd elbe
$ ls
AUTHORS  ChangeLog  COPYING  debian  dockerfile  docs  elbe   elbepack
examples INSTALL    Makefile README  setup.py    test  THANKS TODO</pre>
</div>
</div>
<div class="paragraph">
<p>ELBE can run without being installed from the git checkout.<br>
Just note that file paths are different under this situation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>elbe -&gt; ./elbe
/usr/share/doc/elbe-doc/examples -&gt; examples/</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-initvm-and-submit-xml-files">Create initvm and submit XML files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first thing you need to do is set up a virtual-machine for<br>
generating root-filesystems.</p>
</div>
<div class="paragraph">
<p>This virtual-machine is referred to as "initvm". You will want your<br>
initvm to be the same architecture as your workstation. This allows<br>
using hardware accelerated virtualization implemented by kvm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ elbe initvm create --directory=initvm
/home/torbenh/elbe/elbe/initvm
gpg: keyring `/tmp/tmpPfPXt4/secring.gpg' created
gpg: keyring `/tmp/tmpPfPXt4/etc/apt/trusted.gpg.d/linutronix-elbe.gpg' created
gpg: key 22BB8F84: public key "ELBE Devel (Linutronix ELBE developers) &lt;elbe-devel@linutronix.de&gt;" imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)
--2015-08-17 15:26:26--  http://debian.linutronix.de/elbe/elbe-repo.pub
Resolving debian.linutronix.de (debian.linutronix.de)... 2001:470:1f0b:db:abcd:42:0:1, 62.245.132.108
Connecting to debian.linutronix.de (debian.linutronix.de)|2001:470:1f0b:db:abcd:42:0:1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1763 (1.7K)
Saving to: ‘/tmp/tmpPfPXt4/tmpkey.gpg’

/tmp/tmpPfPXt4/tmpkey.gpg             100%[========================================================================&gt;]   1.72K  --.-KB/s   in 0s

2015-08-17 15:26:26 (346 MB/s) - ‘/tmp/tmpPfPXt4/tmpkey.gpg’ saved [1763/1763]

...

Installing the base system  ... 17%... 20%... 30%... 40%... 50%... 60%... 70%... 83%... 91%... 100%
Configuring apt  ... 16%... 25%... 32%... 41%... 50%... 66%... 75%... 83%... 91%... 100%
Select and install software  ... 10%... 26%... 31%... 40%... 50%... 61%... 70%... 80%... 90%... 100%
Installing GRUB boot loader  ... 16%... 33%... 50%... 66%... 83%... 100%
The system is going down NOW!.. 14%... 23%... 33%... 42%... 52%... 61%... 71%... 80%... 90%
Sent SIGTERM to all processes
Sent SIGKILL to all processes
Requesting system reboot
[  589.432092] Restarting system.
mkdir -p .stamps
touch .stamps/stamp-install-initial-image</pre>
</div>
</div>
<div class="paragraph">
<p>This creates an "initvm" subdirectory and builds the initvm inside this directory.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="submitting-an-xml-file">Submitting an XML file</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Submitting an XML file triggers an image build inside the initvm.<br>
Once the initvm has been created and is running, you can submit XML files using</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ elbe initvm submit --directory=initvm /usr/share/doc/elbe-doc/examples/rescue.xml
Build started, waiting till it finishes
project still busy, waiting
project still busy, waiting

...

project still busy, waiting
project still busy, waiting
project still busy, waiting

Build finished !


ELBE Package validation
=======================


Package List validation
 ----------------------

No Errors found

Getting generated Files

Saving generated Files to /home/torbenh/elbe/elbe/elbe-build-20150817-155038
source.xml      (Current source.xml of the project)
rescue.cpio     (Image)
validation.txt  (Package list validation result)
elbe-report.txt         (Report)
log.txt         (Log file)</pre>
</div>
</div>
<div class="paragraph">
<p>The result of the build is stored in elbe-build-&lt;TIMESTAMP&gt; below your current<br>
working directory.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ports-opened-by-initvm">Ports opened by initvm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The initvm will open port 7587 on localhost. This is used by the elbe tools<br>
on your host to communicate with the initvm.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-usage">Advanced usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="elbe-archive">ELBE Archive</h3>
<div class="paragraph">
<p>The ELBE XML file contains an archive which is extracted into the<br>
root-filesystem during the image generation phase.</p>
</div>
<div class="paragraph">
<p>It is acessed with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ elbe get_archive fun.xml archive.tar.bz2</pre>
</div>
</div>
<div class="paragraph">
<p>It is a normal tar.bz2 which can be manipulated and reinjected into the XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir arch
$ tar xvfj archive.tar.bz2 -C arch
$ echo hello &gt; arch/hello
$ elbe chg_archive fun.xml arch</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-packages-to-the-list-of-packages-to-install">Adding packages to the "list of packages to install"</h3>
<div class="paragraph">
<p>The XML file contains a <em>list of packages to install</em> <code>&lt;pkg-list&gt;</code> in the<br>
<code>&lt;target&gt;</code> XML node. Inserting a line containing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;pkg&gt;util-linux&lt;/pkg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>will add the <code>util-linux</code> package to the target-rfs.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-finetuning-rules">Using the finetuning rules</h3>
<div class="paragraph">
<p>An ELBE XML file can contain a set of finetuning rules. Finetuning is used to<br>
customize the target-rfs, e.g. remove man-pages. Here is an example<br>
finetuning from <code>/usr/share/doc/elbe-doc/examples/elbe-desktop.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;finetuning&gt;
	&lt;rm&gt;var/cache/apt/archives/*.deb&lt;/rm&gt;
	&lt;adduser passwd="elbe" shell="/bin/bash"&gt;elbe&lt;/adduser&gt;
&lt;/finetuning&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="rm">rm</h4>
<div class="paragraph">
<p>The <code>&lt;rm&gt;</code> node removes files from the target-rfs.</p>
</div>
</div>
<div class="sect3">
<h4 id="adduser">adduser</h4>
<div class="paragraph">
<p>The adduser node allows to create a user.<br>
The following example creates the user <code>elbe</code> with the password <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify groups the new user should be part of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;adduser passwd="foo" shell="/bin/bash" groups="audio,video,dialout"&gt;elbe&lt;/adduser&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changing-ownership-of-directories-or-files">Changing ownership of directories or files</h3>
<div class="paragraph">
<p>There is currently no special finetuning node for <code>chmod</code> and <code>chown</code>.<br>
These commands needs to be specified via the command tag, which allows running<br>
any command that is available in the target-rfs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;command&gt;chown elbe:elbe /mnt&lt;/command&gt;
&lt;command&gt;chmod 777 /mnt&lt;/command&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="further-example">Further Example</h4>
<div class="paragraph">
<p>A more complete example can be found in the ELBE overview document that is<br>
installed at <code>/usr/share/doc/elbe-doc/elbeoverview-en.html</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-elbe-pbuilder-feature">Using the Elbe Pbuilder Feature</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Version 1.9.2, elbe is able to create a pbuilder Environment.<br>
You can create a pbuilder for a specific xml File inside the initvm.</p>
</div>
<div class="paragraph">
<p>The repositories and architecture specified in the xml File will be used<br>
to satisfy build dependencies.<br>
Pbuilder will only build debianised Software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Currently only source formats <code>3.0 (native)</code> and <code>3.0 (git)</code> are supported<br>
      and tested. <code>3.0 (quilt)</code> does not work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A pbuilder instance is always associated with a project inside the initvm.<br>
The <code>pbuilder create</code> command will write the project uuid to a file, if instructed to<br>
do so.</p>
</div>
<div class="paragraph">
<p><code>pbuilder build</code> works like <code>pdebuild</code>, in that it uploads the current working directory<br>
into the initvm pbuilder project, and then builds it using the pbuilder instance<br>
created earlier.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ elbe pbuilder create --xmlfile fun.xml --writeproject fun.prj
$ cd program
$ elbe pbuilder build --project `cat ../fun.prj` --output ../out</pre>
</div>
</div>
</div>
</div>
      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
        
      
			<li><a href="http://elbe-rfs.org" ></a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">
		&#169; 2016
		<a href="http://elbe-rfs.org">ELBE</a> by
		<a href="https://linutronix.de">Linutronix GmbH</a> -
		ELBE is not affiliated with Debian, Debian is a registered trademark owned by SPI
	</p>
</footer>



    </div>

    <script src="http://elbe-rfs.org/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://elbe-rfs.org/js/main.js"></script>

  </body>

</html>
